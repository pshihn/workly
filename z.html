<html>

<head>
  <title>Workly test</title>
  <script src="index.js"></script>
</head>

<body>
  <script>
    async function test2() {
      // OBJ tests
      // console.log('count', await w.count);
      // await w.increment();
      // console.log('count', await w.count);
      // await w.increment();
      // console.log('count', await w.count);
      // console.log('stored', await w.stored);
      // w.stored = 21;
      // console.log('stored', await w.stored);
      // console.log('add', await w.add(4, 6));
      // console.log('add', await w.add(24, 225));
      // console.log('delayedAdd', await w.delayedAdd(13, 131));

      // Adder class
      // let wi = await new w();
      // console.log(wi);
      // console.log(await wi.addCount);
      // console.log(await wi.subCount);
      // console.log(await wi.subc);
      // wi.subCount = 2;
      // console.log(await wi.subc);
      // console.log(await wi.add(2, 9));
      // console.log(await wi.sub(2, 9));
      // console.log(await wi.delayedAdd(4, 15));
      // console.log(await wi.delayedSub(4, 15));
    }

    var obj = {
      count: 1,
      stored: 0,
      increment() {
        this.count++;
      },
      add(a, b) {
        return a + b;
      },
      delayedAdd(a, b) {
        return new Promise(resolve => {
          setTimeout(() => {
            resolve({ result: a + b });
          }, 2000);
        });
      }
    };

    class Adder {
      constructor() {
        this.addCount = -1;
        this.subCount = -1;
      }

      get subc() {
        return this.subCount;
      }

      add(a, b) {
        return a + b;
      }

      sub(a, b) {
        return a - b;
      }

      delay() {
        return new Promise(resolve => {
          setTimeout(() => {
            resolve();
          }, 1000);
        });
      }

      delayedAdd(a, b) {
        return new Promise(resolve => {
          setTimeout(() => {
            resolve({ result: a + b });
          }, 2000);
        });
      }

      async delayedSub(a, b) {
        await this.delay();
        return a - b;
      }
    }

    async function test1() {
      const fAdd = function (a, b) {
        let st = Date.now();
        while (true) {
          if ((Date.now() - st) > 1000) {
            break;
          }
        }
        return a + b;
      };

      const w = workly(fAdd);
      console.log(await w(3, 4));
      console.log(await w(13, -4));
    }

    async function test2() {
      const fDelayedAdd = function (a, b) {
        return new Promise(resolve => {
          setTimeout(() => {
            resolve({ result: a + b });
          }, 2000);
        });
      }
      const w = workly(fDelayedAdd);
      console.log(await w(3, 4));
      console.log(await w(13, -4));
    }

    async function test3() {
      const w = workly(Adder);
      const wi = await new w();
      console.log(await wi.addCount);
      console.log(await wi.subCount);
      console.log(await wi.subc);
      wi.subCount = 2;
      console.log(await wi.subc);
      console.log(await wi.add(2, 9));
      console.log(await wi.sub(2, 9));
      console.log(await wi.delayedAdd(4, 15));
      console.log(await wi.delayedSub(4, 15));
    }

    async function runTests() {
      console.log("Test 1");
      await test1();
      console.log("Test 2");
      await test2();
      console.log("Test 3");
      await test3();
    }

    runTests();
  </script>
</body>

</html>