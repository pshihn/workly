(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?b(exports):'function'==typeof define&&define.amd?define(['exports'],b):b(a.workly={})})(this,function(a){'use strict';function b(a,c){return c=c||[],new Proxy(function(){},{get(d,e,f){if('then'===e){if(0===c.length)return{then:()=>f};const b=a.remote({type:'GET',path:c});return b.then.bind(b)}return b(a,c.concat(e))},set(b,d,e){return a.remote({type:'SET',path:c.concat(d),value:e})},apply(b,d,e){return a.remote({type:'APPLY',path:c,args:e})},construct(b,c){return a.remote({type:'CONSTRUCT',args:c})}})}function c(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}function d(a){const b={},d=(a)=>{const d=`${Date.now()}-${c()}`;return b[d]=a,d};self.addEventListener('message',async(c)=>{let e=c.data||{};e.path=e.path||[];let f=e.target&&b[e.target]||a;const g=(a)=>a.reduce((a,b)=>a?a[b]:a,f),h=e&&e.id;if(h&&e.type){const a={id:h},b=g(e.path),c=g(e.path.slice(0,-1));switch(e.type){case'GET':a.value=b;break;case'SET':let f=e.path.length&&e.path[e.path.length-1];f&&(c[f]=e.value),a.value=!!f;break;case'APPLY':try{a.value=await b.apply(c,e.args||[])}catch(b){a.error=b.toString()}break;case'CONSTRUCT':try{a.value=new b(...e.args),a.targetId=d(a.value)}catch(b){a.error=b.toString()}}self.postMessage(a)}})}class e{constructor(a,d){this.w=a,this.uid=d||`${Date.now()}-${c()}`,this.c=0,this.cbs={},a.addEventListener('message',(c)=>{if(this.w.oURL)try{URL.revokeObjectURL(this.w.oURL)}catch(a){}finally{delete this.w.oURL}let d=c.data&&c.data.id,f=d&&this.cbs[d];f&&(delete this.cbs[d],c.data.error?f[1](new Error(c.data.error)):f[0](c.data.targetId?b(new e(a,c.data.targetId)):c.data.value))})}remote(a){const b=a.args||[],c=`${this.uid}-${++this.c}`;return new Promise((d,e)=>{this.cbs[c]=[d,e],this.w.postMessage(Object.assign({},a,{id:c,args:b,target:this.uid}))})}}a.proxy=function(a){let f,g;if('function'==typeof a){const b=Function.prototype.toString;f=g=URL.createObjectURL(new Blob([`${b.call(c)}\n(${b.call(d)})(${b.call(a)})`]))}else'string'==typeof a&&(f=a,0===a.indexOf('blob:')&&(g=f));if(f){let a=new Worker(f);return g&&(a.oURL=g),b(new e(a))}throw'Workly only supports functions, classes, urls'},a.expose=d,Object.defineProperty(a,'__esModule',{value:!0})});